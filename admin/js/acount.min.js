/********************************************
 * @auth: zhongwanshan
 * @des: 千裙百色后台管理 登录/注册/忘记密码 模块脚本
 * @email: 764341548@qq.com
 ********************************************/
(function () {
	/* START 模拟 向服务器端发送 http 请求 */
	$.mockjax({
		url: CONFIG.SERVER + CONFIG.INTERFACE.LOGIN,
		responseText: {
			"resultCode": 0,
			"resultMsg": "登录成功"
		}
	});
	/* END 模拟 向服务器端发送 http 请求 */                   
	// 点击登录
	$('#js-loginAction').on('click', function () {
		var userNameInput = $('#userName'); // 用户名元素
		var passwordInput = $('#password'); // 密码元素
		var rememberCheckBox = $('#remember');  // 记住我元素
		var userNameVal = userNameInput.val(); // 用户名值
		var passwordVal = passwordInput.val(); // 密码值
		var rememberVal = rememberCheckBox.attr('data-remember'); // 记住我状态值
		var bool = true;
                        
		// 验证用户名是否为空
		if (userNameVal.length == 0) {
			userNameInput.addClass('form-control--error');
			bool = false;
		}
                        
		// 验证密码是否为空
		if (passwordVal.length == 0) {
			passwordInput.addClass('form-control--error');
			bool = false;
		}

		if (bool == true) {
			admin.getDataFromServer({
				"url": CONFIG.SERVER + CONFIG.INTERFACE.LOGIN,
				"data": {
					"userName": userNameVal,
					"password": passwordVal,
					"remember": rememberVal
				},
				"successCallBack": function (data) {
					
					if (data.resultCode == '0') {
						window.location.href = '../../index.html';
					} else {
						$('.errorMsg').html(data.resultMsg);
					}
				},
				"failCallBack": function (XMLHttpRequest, textStatus, errorThrown) {

				}
			});
		}
	});
	
	/* START 模拟 向服务器端发送 http 请求 */
	$.mockjax({
		url: CONFIG.SERVER + CONFIG.INTERFACE.REGISTE,
		responseText: {
			"resultCode": 0,
			"resultMsg": "注册成功"
		}
	});
	/* END 模拟 向服务器端发送 http 请求 */
	// 点击注册
	$('#js-registeAction').on('click', function() {
		var userNameInput = $('#userName'); // 用户名元素
		var emailInput = $('#email'); // 邮箱元素
		var passwordInput = $('#password'); // 密码元素
		var confirmPasswordInput = $('#confirmPassword'); // 确认密码元素
		var userNameVal = userNameInput.val(); // 用户名值
		var passwordVal = passwordInput.val(); // 密码值
		var emailVal = emailInput.val(); // 邮箱值
		var confirmPasswordVal = confirmPasswordInput.val(); // 确认密码值
		var bool = true;
                        
		// 验证用户名是否为空
		if (userNameVal.length == 0) {
			userNameInput.addClass('form-control--error');
			bool = false;
		}
                        
		// 验证密码是否为空
		if (passwordVal.length == 0) {
			passwordInput.addClass('form-control--error');
			bool = false;
		}
		
		// 验证电子邮箱是否为空
		if (emailVal.length == 0) {
			emailInput.addClass('form-control--error');
			bool = false;
		}
                        
		// 验证确认密码是否为空
		if (confirmPasswordVal.length == 0) {
			confirmPasswordInput.addClass('form-control--error');
			bool = false;
		}
		
		// 如果输入都不为空
		if (bool == true) {
			
			// 验证邮箱格式
			if (!CONFIG.REGEXP.EMAIL.test(emailVal)) {
				$('.errorMsg').show().html('邮箱格式不正确！');
				emailInput.addClass('form-control--error');	
				return;
			}
			
			// 确认密码是否与密码相同
			if (passwordVal != confirmPasswordVal) {
				$('.errorMsg').html('两次密码不一致');
				confirmPasswordInput.addClass('form-control--error');
				return;
			}
			
			// 把注册信息提交到服务器
			admin.getDataFromServer({
				"url": CONFIG.SERVER + CONFIG.INTERFACE.REGISTE,
				"data": {
					"userName": userNameVal,
					"email": emailVal,
					"password": passwordVal,
					"confirmPassword": confirmPasswordVal
				},
				"successCallBack": function (data) {
					
					if (data.resultCode == '0') {
						window.location.href = './login.html';
					} else {
						$('.errorMsg').html(data.resultMsg);
					}
				},
				"failCallBack": function (XMLHttpRequest, textStatus, errorThrown) {
					$('.errorMsg').html(textStatus);
				}
			});
		}
		
	});
	
	/* START 模拟 向服务器端发送 http 请求 */
	$.mockjax({
		url: CONFIG.SERVER + CONFIG.INTERFACE.FINDPASSWORD,
		responseText: {
			"resultCode": 0,
			"resultMsg": "修改密码成功"
		}
	});
	/* END 模拟 向服务器端发送 http 请求 */
	// 找回密码
	$('#js-findPassword').on('click', function() {
		var emailInput = $('#email'); // 邮箱元素
		var passwordInput = $('#password'); // 密码元素
		var confirmPasswordInput = $('#confirmPassword'); // 确认密码元素
		var passwordVal = passwordInput.val(); // 密码值
		var emailVal = emailInput.val(); // 邮箱值
		var confirmPasswordVal = confirmPasswordInput.val(); // 确认密码值
		var bool = true;
                        
		// 验证密码是否为空
		if (passwordVal.length == 0) {
			passwordInput.addClass('form-control--error');
			bool = false;
		}
		
		// 验证电子邮箱是否为空
		if (emailVal.length == 0) {
			emailInput.addClass('form-control--error');
			bool = false;
		}
                        
		// 验证确认密码是否为空
		if (confirmPasswordVal.length == 0) {
			confirmPasswordInput.addClass('form-control--error');
			bool = false;
		}
		
		// 如果输入都不为空
		if (bool == true) {
			
			// 确认密码是否与密码相同
			if (passwordVal != confirmPasswordVal) {
				$('.errorMsg').show().html('两次密码不一致');
				confirmPasswordInput.addClass('form-control--error');
				return;
			}
			
			// 把注册信息提交到服务器
			admin.getDataFromServer({
				"url": CONFIG.SERVER + CONFIG.INTERFACE.FINDPASSWORD,
				"data": {
					"email": emailVal,
					"password": passwordVal,
					"confirmPassword": confirmPasswordVal
				},
				"successCallBack": function (data) {
					
					if (data.resultCode == '0') {
						window.location.href = './login.html';
					} else {
						$('.errorMsg').html(data.resultMsg);
					}
				},
				"failCallBack": function (XMLHttpRequest, textStatus, errorThrown) {
					$('.errorMsg').html(textStatus);
				}
			});
		}
	});
                    
	// 获取焦点时，去除错误提示
	$('.js-focus').on('focus', function () {
		var self = $(this);
		$('.errorMsg').hide();
		self.removeClass('form-control--error');
	});
	
	// 切换记住我状态
	$('#js-remember').on('click', function() {
		var self = $(this);
		var inputCheckBox = self.find('input');
		var rememberVal = inputCheckBox.attr('data-remember');
			
		if (rememberVal == '0') {
			inputCheckBox.attr('data-remember', '1');
		} else if (rememberVal == '1') {
			inputCheckBox.attr('data-remember', '0');
		}
	});
	
} ());

